# =============================================
# CONFIGURATION GLOBALE - TOUS LES SERVICES
# =============================================

# =============================================
# SERVICE DISCOVERY - EUREKA
# =============================================
eureka.client.service-url.defaultZone=http://localhost:8761/eureka
eureka.client.register-with-eureka=true
eureka.client.fetch-registry=true
eureka.client.healthcheck.enabled=true

eureka.instance.prefer-ip-address=true
eureka.instance.instance-id=${spring.application.name}:${server.port}
eureka.instance.lease-renewal-interval-in-seconds=5
eureka.instance.lease-expiration-duration-in-seconds=10

# =============================================
# MONITORING - ACTUATOR
# =============================================
management.endpoints.web.exposure.include=health,info,metrics,env,configprops,circuitbreakers,refresh
management.endpoint.health.show-details=always
management.endpoint.health.show-components=always

# =============================================
# RESILIENCE4J - CIRCUIT BREAKER (Commun)
# =============================================
resilience4j.circuitbreaker.configs.default.register-health-indicator=true
resilience4j.circuitbreaker.configs.default.sliding-window-size=10
resilience4j.circuitbreaker.configs.default.failure-rate-threshold=50
resilience4j.circuitbreaker.configs.default.wait-duration-in-open-state=5s
resilience4j.circuitbreaker.configs.default.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.configs.default.automatic-transition-from-open-to-half-open-enabled=true

resilience4j.retry.configs.default.max-attempts=3
resilience4j.retry.configs.default.wait-duration=2s

# =============================================
# TRACING - ZIPKIN
# =============================================
management.tracing.enabled=true
management.tracing.sampling.probability=1.0
management.tracing.exporter.zipkin.endpoint=http://localhost:9411/api/v2/spans

# =============================================
# LOGGING (Commun)
# =============================================
logging.pattern.level=%5p [${spring.application.name:},%X{traceId:-},%X{spanId:-}]
logging.level.com.example=INFO
logging.level.org.springframework.cloud=INFO
logging.level.org.hibernate=WARN
logging.level.org.eclipse.jgit=WARN

# =============================================
# DATABASE - H2 (Développement)
# =============================================
spring.datasource.url=jdbc:h2:mem:testdb
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=

spring.h2.console.enabled=true
spring.h2.console.path=/h2-console

spring.jpa.hibernate.ddl-auto=create-drop
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect

# =============================================
# OPENAPI / SWAGGER
# =============================================
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.operations-sorter=method

# =============================================
# WEB CONFIGURATION
# =============================================
server.servlet.context-path=/
server.compression.enabled=true
server.connection-timeout=5000

# =============================================
# SPRING CLOUD CONFIG (Pour les clients)
# =============================================
spring.cloud.config.fail-fast=true
spring.cloud.config.retry.max-attempts=6
spring.cloud.config.retry.max-interval=2000

# =============================================
# RESILIENCE4J - TIMELIMITER (Commun)
# =============================================
resilience4j.timelimiter.configs.default.timeout-duration=3s

# =============================================
# HTTP CLIENT CONFIGURATION
# =============================================
spring.webclient.httpclient.connect-timeout=2000
spring.webclient.httpclient.response-timeout=5s

# =============================================
# GATEWAY DEFAULTS (Si applicable)
# =============================================
spring.cloud.gateway.httpclient.connect-timeout=2000
spring.cloud.gateway.httpclient.response-timeout=5s
spring.cloud.gateway.discovery.locator.enabled=true
spring.cloud.gateway.discovery.locator.lower-case-service-id=true

# =============================================
# SECURITY DEFAULTS (Pour Authorization Service)
# =============================================
# Ces valeurs seront écrasées par authorization-service.properties
spring.security.oauth2.resourceserver.jwt.issuer-uri=http://localhost:9000
spring.security.user.name=default-user
spring.security.user.password=default-pass

# =============================================
# FEIGN CLIENT DEFAULTS
# =============================================
feign.client.config.default.connect-timeout=5000
feign.client.config.default.read-timeout=10000
feign.client.config.default.logger-level=basic

# =============================================
# REST TEMPLATE DEFAULTS
# =============================================
rest.template.timeout.connect=5000
rest.template.timeout.read=10000

# =============================================
# APPLICATION HEALTH CHECKS
# =============================================
management.health.diskspace.enabled=true
management.health.db.enabled=true
management.health.circuitbreakers.enabled=true

# =============================================
# CORS CONFIGURATION (Développement)
# =============================================
# spring.web.cors.allowed-origins=http://localhost:3000
# spring.web.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
# spring.web.cors.allowed-headers=*
# spring.web.cors.allow-credentials=true